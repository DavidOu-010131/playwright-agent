<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Playwright Agent - 自动化测试平台</title>
    <link rel="stylesheet" href="/static/style.css">
</head>
<body>
    <div class="container">
        <div class="header">
            <div class="header-left">
                <button class="btn-back" id="btnBack" onclick="goBackToProjects()" style="display: none;" title="返回项目列表">
                    <svg viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
                        <path d="M20 11H7.83l5.59-5.59L12 4l-8 8 8 8 1.41-1.41L7.83 13H20v-2z"/>
                    </svg>
                </button>
                <div class="header-icon">
                    <svg width="40" height="40" viewBox="0 0 46 46" xmlns="http://www.w3.org/2000/svg">
                        <circle fill="#FFFFFF" stroke="#E0E0E0" stroke-width="1" cx="23" cy="23" r="22"/>
                        <g transform="translate(10.6541, 10)" fill="#04785C">
                            <rect x="16.3548387" y="10.9032258" width="2.93548387" height="4.19354839"/>
                            <rect x="22.6451613" y="10.9032258" width="2.93548387" height="4.19354839"/>
                            <path d="M13,0 C16.9457637,0 20.4809474,1.75790165 22.8651008,4.53325453 L19.7162276,7.30359274 C18.1008699,5.4009235 15.6914337,4.19354839 13,4.19354839 C8.13633107,4.19354839 4.19354839,8.13633107 4.19354839,13 C4.19354839,17.8636689 8.13633107,21.8064516 13,21.8064516 C15.6575522,21.8064516 18.0401621,20.6292836 19.6548455,18.7679318 L22.8728079,21.4577656 C20.4885695,24.2383059 16.9500176,26 13,26 C5.82029825,26 0,20.1797017 0,13 C0,5.82029825 5.82029825,0 13,0 Z"/>
                        </g>
                    </svg>
                </div>
                <h1 id="pageTitle">Playwright Agent</h1>
            </div>
            <div class="header-right">
                <div class="current-env-indicator" id="currentEnvIndicator" style="display: none;">
                    <span class="env-dot"></span>
                    <span class="env-name"></span>
                </div>
            </div>
        </div>

        <!-- 项目列表页面 -->
        <div class="page-projects" id="pageProjects">
            <div class="projects-header">
                <h2>项目列表</h2>
                <button class="btn-primary" onclick="showCreateProjectModal()">
                    <svg viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg" style="width: 16px; height: 16px; fill: currentColor;">
                        <path d="M19 13h-6v6h-2v-6H5v-2h6V5h2v6h6v2z"/>
                    </svg>
                    新建项目
                </button>
            </div>
            <div class="projects-grid" id="projectsGrid"></div>
        </div>

        <!-- 项目详情页面 (默认隐藏) -->
        <div class="page-detail" id="pageDetail" style="display: none;">
            <!-- 标签页导航 -->
            <div class="tabs-nav">
                <button class="tab-btn active" data-tab="scenarios" onclick="switchTab('scenarios')">
                    <svg viewBox="0 0 24 24"><path d="M19 3H5c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h14c1.1 0 2-.9 2-2V5c0-1.1-.9-2-2-2zm-5 14H7v-2h7v2zm3-4H7v-2h10v2zm0-4H7V7h10v2z"/></svg>
                    场景
                </button>
                <button class="tab-btn" data-tab="uimap" onclick="switchTab('uimap')">
                    <svg viewBox="0 0 24 24"><path d="M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm-1 17.93c-3.95-.49-7-3.85-7-7.93 0-.62.08-1.21.21-1.79L9 15v1c0 1.1.9 2 2 2v1.93zm6.9-2.54c-.26-.81-1-1.39-1.9-1.39h-1v-3c0-.55-.45-1-1-1H8v-2h2c.55 0 1-.45 1-1V7h2c1.1 0 2-.9 2-2v-.41c2.93 1.19 5 4.06 5 7.41 0 2.08-.8 3.97-2.1 5.39z"/></svg>
                    UI Map
                </button>
                <button class="tab-btn" data-tab="runner" onclick="switchTab('runner')">
                    <svg viewBox="0 0 24 24"><path d="M8 5v14l11-7z"/></svg>
                    运行器
                </button>
                <button class="tab-btn" data-tab="settings" onclick="switchTab('settings')">
                    <svg viewBox="0 0 24 24"><path d="M19.14 12.94c.04-.31.06-.63.06-.94 0-.31-.02-.63-.06-.94l2.03-1.58c.18-.14.23-.41.12-.61l-1.92-3.32c-.12-.22-.37-.29-.59-.22l-2.39.96c-.5-.38-1.03-.7-1.62-.94l-.36-2.54c-.04-.24-.24-.41-.48-.41h-3.84c-.24 0-.43.17-.47.41l-.36 2.54c-.59.24-1.13.57-1.62.94l-2.39-.96c-.22-.08-.47 0-.59.22L2.74 8.87c-.12.21-.08.47.12.61l2.03 1.58c-.04.31-.06.63-.06.94s.02.63.06.94l-2.03 1.58c-.18.14-.23.41-.12.61l1.92 3.32c.12.22.37.29.59.22l2.39-.96c.5.38 1.03.7 1.62.94l.36 2.54c.05.24.24.41.48.41h3.84c.24 0 .44-.17.47-.41l.36-2.54c.59-.24 1.13-.56 1.62-.94l2.39.96c.22.08.47 0 .59-.22l1.92-3.32c.12-.22.07-.47-.12-.61l-2.01-1.58zM12 15.6c-1.98 0-3.6-1.62-3.6-3.6s1.62-3.6 3.6-3.6 3.6 1.62 3.6 3.6-1.62 3.6-3.6 3.6z"/></svg>
                    设置
                </button>
            </div>

            <!-- 场景标签页 -->
            <div class="tab-content active" id="tab-scenarios">
                <div class="tab-header">
                    <h2>测试场景</h2>
                    <button class="btn-primary" onclick="showCreateScenarioModal()">
                        <svg viewBox="0 0 24 24"><path d="M19 13h-6v6h-2v-6H5v-2h6V5h2v6h6v2z"/></svg>
                        新建场景
                    </button>
                </div>
                <div class="scenario-list" id="scenarioList"></div>
            </div>

            <!-- UI Map 标签页 -->
            <div class="tab-content" id="tab-uimap">
                <div class="tab-header">
                    <h2>UI Map</h2>
                    <button class="btn-primary" onclick="showCreateUIMapModal()">
                        <svg viewBox="0 0 24 24"><path d="M19 13h-6v6h-2v-6H5v-2h6V5h2v6h6v2z"/></svg>
                        新建 UI Map
                    </button>
                </div>
                <div class="uimap-list" id="uimapList"></div>
            </div>

            <!-- 运行器标签页 -->
            <div class="tab-content" id="tab-runner">
                <div class="runner-layout">
                    <div class="runner-left">
                        <div class="card">
                            <h3>运行配置</h3>
                            <div class="form-group">
                                <label>选择场景</label>
                                <select id="runnerScenarioSelect"></select>
                            </div>
                            <div class="form-group">
                                <label>选择环境</label>
                                <select id="runnerEnvSelect"></select>
                            </div>
                            <div class="option-row">
                                <span class="option-label">无头模式</span>
                                <div class="toggle-switch active" id="runnerHeadlessToggle" onclick="toggleRunnerHeadless()"></div>
                            </div>
                            <div class="option-row">
                                <span class="option-label">录制视频</span>
                                <div class="toggle-switch" id="runnerVideoToggle" onclick="toggleRunnerVideo()"></div>
                            </div>
                            <button class="btn-primary btn-run" id="btnStartRun" onclick="startRun()">
                                <svg viewBox="0 0 24 24"><path d="M8 5v14l11-7z"/></svg>
                                开始运行
                            </button>
                        </div>
                        <div class="card">
                            <div class="card-header">
                                <h3>运行历史</h3>
                            </div>
                            <div class="history-list-mini" id="runnerHistoryList"></div>
                        </div>
                    </div>
                    <div class="runner-right">
                        <div class="card runner-output">
                            <div class="runner-tabs">
                                <button class="runner-tab active" data-rtab="steps" onclick="switchRunnerTab('steps')">步骤</button>
                                <button class="runner-tab" data-rtab="logs" onclick="switchRunnerTab('logs')">日志</button>
                                <button class="runner-tab" data-rtab="screenshots" onclick="switchRunnerTab('screenshots')">截图</button>
                                <button class="runner-tab" data-rtab="network" onclick="switchRunnerTab('network')">网络</button>
                            </div>
                            <div class="runner-tab-content active" id="rtab-steps">
                                <div class="steps-list" id="stepsList"></div>
                            </div>
                            <div class="runner-tab-content" id="rtab-logs">
                                <div class="log-area" id="runnerLogArea"></div>
                            </div>
                            <div class="runner-tab-content" id="rtab-screenshots">
                                <div class="screenshots-grid" id="screenshotsGrid"></div>
                            </div>
                            <div class="runner-tab-content" id="rtab-network">
                                <div class="network-list" id="networkList"></div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- 设置标签页 -->
            <div class="tab-content" id="tab-settings">
                <div class="settings-page">
                    <div class="settings-section">
                        <h3>项目信息</h3>
                        <div class="form-group">
                            <label>项目名称</label>
                            <input type="text" id="settingsProjectName">
                        </div>
                        <div class="form-group">
                            <label>项目描述</label>
                            <textarea id="settingsProjectDesc"></textarea>
                        </div>
                        <div class="form-group">
                            <label>默认超时 (ms)</label>
                            <input type="number" id="settingsTimeout" value="30000">
                        </div>
                        <div class="form-group">
                            <label>浏览器通道</label>
                            <select id="settingsBrowserChannel">
                                <option value="">默认 (Chromium)</option>
                                <option value="chrome">Chrome</option>
                                <option value="msedge">Edge</option>
                            </select>
                        </div>
                        <button class="btn-primary" onclick="saveProjectSettings()">保存项目设置</button>
                        <button class="btn-danger" onclick="deleteProject()">删除项目</button>
                    </div>

                    <div class="settings-section">
                        <div class="section-header">
                            <h3>环境配置</h3>
                            <button class="btn-small" onclick="showAddEnvModal()">添加环境</button>
                        </div>
                        <div class="env-list" id="envList"></div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- 创建项目弹框 -->
    <div class="modal-overlay" id="createProjectModal">
        <div class="modal">
            <h3>新建项目</h3>
            <div class="form-group">
                <label>项目名称</label>
                <input type="text" id="projectName" placeholder="输入项目名称">
            </div>
            <div class="form-group">
                <label>项目描述 (可选)</label>
                <textarea id="projectDescription" placeholder="输入项目描述"></textarea>
            </div>
            <div class="modal-buttons">
                <button class="modal-btn modal-btn-primary" onclick="createProject()">创建</button>
                <button class="modal-btn modal-btn-cancel" onclick="closeCreateProjectModal()">取消</button>
            </div>
        </div>
    </div>

    <!-- 创建场景弹框 -->
    <div class="modal-overlay" id="createScenarioModal">
        <div class="modal">
            <h3 id="scenarioModalTitle">新建场景</h3>
            <div class="form-group">
                <label>场景名称</label>
                <input type="text" id="scenarioName" placeholder="输入场景名称">
            </div>
            <div class="form-group">
                <label>场景描述</label>
                <textarea id="scenarioDescription" placeholder="输入场景描述"></textarea>
            </div>
            <div class="modal-buttons">
                <button class="modal-btn modal-btn-primary" onclick="saveScenario()">保存</button>
                <button class="modal-btn modal-btn-cancel" onclick="closeCreateScenarioModal()">取消</button>
            </div>
        </div>
    </div>

    <!-- 场景编辑弹框 -->
    <div class="modal-overlay" id="scenarioEditorModal">
        <div class="modal modal-large">
            <div class="modal-header">
                <h3 id="editorScenarioName">编辑场景</h3>
                <button class="btn-close" onclick="closeScenarioEditor()">
                    <svg viewBox="0 0 24 24"><path d="M19 6.41L17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"/></svg>
                </button>
            </div>
            <div class="scenario-editor">
                <div class="steps-editor" id="stepsEditor"></div>
                <button class="btn-add-step" onclick="addStep()">
                    <svg viewBox="0 0 24 24"><path d="M19 13h-6v6h-2v-6H5v-2h6V5h2v6h6v2z"/></svg>
                    添加步骤
                </button>
            </div>
            <div class="modal-buttons">
                <button class="modal-btn modal-btn-primary" onclick="saveScenarioSteps()">保存</button>
                <button class="modal-btn modal-btn-cancel" onclick="closeScenarioEditor()">取消</button>
            </div>
        </div>
    </div>

    <!-- 创建 UI Map 弹框 -->
    <div class="modal-overlay" id="createUIMapModal">
        <div class="modal">
            <h3 id="uimapModalTitle">新建 UI Map</h3>
            <div class="form-group">
                <label>名称</label>
                <input type="text" id="uimapName" placeholder="输入 UI Map 名称">
            </div>
            <div class="form-group">
                <label>描述</label>
                <textarea id="uimapDescription" placeholder="输入描述"></textarea>
            </div>
            <div class="modal-buttons">
                <button class="modal-btn modal-btn-primary" onclick="saveUIMap()">保存</button>
                <button class="modal-btn modal-btn-cancel" onclick="closeCreateUIMapModal()">取消</button>
            </div>
        </div>
    </div>

    <!-- UI Map 编辑弹框 -->
    <div class="modal-overlay" id="uimapEditorModal">
        <div class="modal modal-large">
            <div class="modal-header">
                <h3 id="editorUIMapName">编辑 UI Map</h3>
                <button class="btn-close" onclick="closeUIMapEditor()">
                    <svg viewBox="0 0 24 24"><path d="M19 6.41L17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"/></svg>
                </button>
            </div>
            <div class="uimap-editor">
                <div class="elements-list" id="elementsList"></div>
                <button class="btn-add-step" onclick="addElement()">
                    <svg viewBox="0 0 24 24"><path d="M19 13h-6v6h-2v-6H5v-2h6V5h2v6h6v2z"/></svg>
                    添加元素
                </button>
            </div>
            <div class="modal-buttons">
                <button class="modal-btn modal-btn-primary" onclick="saveUIMapElements()">保存</button>
                <button class="modal-btn modal-btn-cancel" onclick="closeUIMapEditor()">取消</button>
            </div>
        </div>
    </div>

    <!-- 添加环境弹框 -->
    <div class="modal-overlay" id="addEnvModal">
        <div class="modal">
            <h3>添加环境</h3>
            <div class="form-group">
                <label>环境名称</label>
                <input type="text" id="envName" placeholder="如: PROD, DEV, TEST">
            </div>
            <div class="form-group">
                <label>Base URL</label>
                <input type="text" id="envBaseUrl" placeholder="https://example.com">
            </div>
            <div class="form-group">
                <label>描述 (可选)</label>
                <textarea id="envDescription" placeholder="输入描述"></textarea>
            </div>
            <div class="modal-buttons">
                <button class="modal-btn modal-btn-primary" onclick="addEnvironment()">添加</button>
                <button class="modal-btn modal-btn-cancel" onclick="closeAddEnvModal()">取消</button>
            </div>
        </div>
    </div>

    <script src="/static/app.js"></script>
</body>
</html>
